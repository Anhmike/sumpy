import os

class DUCHelper(object):
    def __init__(self, duc_path=None):
        if duc_path is None:
            duc_path = os.getenv("DUC_DATA", "~/DUC")
        self.duc04_task1and2_docsets = os.path.join(
            duc_path, "DUC2004_Summarization_Documents", "duc2004_testdata",
            "tasks1and2", "duc2004_tasks1and2_docs")
        self.duc04_task1and2_docset_ids = [
            "d30001t", "d30010t", "d30026t", "d30036t", "d30046t", "d30055t",
            "d31022t", "d31050t", "d30002t", "d30011t", "d30027t", "d30037t",
            "d30047t", "d30056t", "d31026t", "d30003t", "d30015t", "d30028t",
            "d30038t", "d30048t", "d30059t", "d31031t", "d30005t", "d30017t", 
            "d30029t", "d30040t", "d30049t", "d31001t", "d31032t", "d30006t",
            "d30020t", "d30031t", "d30042t", "d30050t", "d31008t", "d31033t",
            "d30007t", "d30022t", "d30033t", "d30044t", "d30051t", "d31009t", 
            "d31038t", "d30008t", "d30024t", "d30034t", "d30045t", "d30053t", 
            "d31013t", "d31043t"]
        self.duc04_task1and2_docset_id2doc_ids = {
            "d30001t": [
                "APW19981016.0240", 
                "APW19981022.0269", 
                "APW19981026.0220",
                "APW19981027.0491", 
                "APW19981031.0167",
                "APW19981113.0251",
                "APW19981116.0205", 
                "APW19981118.0276",
                "APW19981120.0274",
                "APW19981124.0267",
            ],
            "d30002t": [
                "APW19981027.0241", 
                "APW19981028.1120",
                "APW19981029.0570",
                "APW19981031.0720", 
                "APW19981101.0843", 
                "APW19981102.0737",
                "APW19981103.0526",
                "APW19981104.0539",
                "APW19981105.1220",
                "APW19981106.0869",
            ],
            "d30003t": [
                "APW19981018.0423",
                "APW19981019.0098",
                "APW19981020.0241",
                "APW19981021.0557",
                "APW19981022.1132",
                "APW19981023.1166",
                "APW19981024.0192",
                "APW19981025.0449",
                "NYT19981026.0292",
                "APW19981028.0444",
            ],
            "d30005t": [
                "NYT19981003.0093",
                "APW19981003.0517",
                "APW19981111.0288",
                "APW19981112.0551",
                "NYT19981113.0410",
                "APW19981119.0552",
                "APW19981120.0887",
                "APW19981129.0665",
                "NYT19981201.0444",
                "NYT19981202.0428",
            ],
            "d30006t": [
                "NYT19981003.0083",
                "NYT19981005.0385",
                "NYT19981006.0396",
                "NYT19981008.0461",
                "NYT19981013.0354",
                "NYT19981014.0003",
                "NYT19981018.0175",
                "APW19981018.0836",
                "APW19981018.0888",
                "NYT19981021.0014",
            ],
            "d30007t": [
                "APW19981001.0312",
                "APW19981002.0522",  
                "APW19981002.0567",
                "APW19981004.0851",
                "APW19981006.0556",
                "APW19981007.0574",
                "APW19981010.0696",
                "APW19981011.0515",
                "APW19981011.0744",
                "APW19981013.0275",
            ],
            "d30008t": [
                "APW19981004.0281",
                "APW19981006.0251",
                "APW19981013.0853",
                "APW19981016.0437",
                "APW19981019.0104",
                "APW19981023.0281",
                "NYT19981105.0538",
                "APW19981108.0837",
                "APW19981109.0264",
                "APW19981109.0274",
            ],
            "d30010t": [
                "APW19981106.0273",
                "APW19981106.0274",
                "APW19981106.0275",
                "APW19981106.0276",
                "NYT19981107.0251",
                "APW19981107.0568",
                "APW19981107.0744",
                "APW19981107.0752",
                "NYT19981108.0136",
                "APW19981108.0188",
            ],
            "d30011t": [
                "APW19981001.0315",
                "APW19981002.0550",
                "APW19981002.1081",
                "NYT19981003.0120",
                "APW19981003.0144",
                "APW19981004.0281",
                "APW19981005.0484",
                "APW19981006.0251",
                "APW19981008.0259",
                "APW19981008.0527",
           ],
           "d30015t": [
                "NYT19981004.0102",
                "APW19981005.0205",
                "APW19981005.0223",
                "APW19981005.0233",
                "NYT19981005.0391",
                "APW19981005.0496",
                "APW19981005.0506",
                "APW19981005.0762",
                "APW19981005.1072",
                "APW19981005.1082",
            ],
            "d30017t": [
                "APW19981010.0187",
                "APW19981022.0488",
                "APW19981104.0245",
                "APW19981110.0240",
                "NYT19981114.0099",
                "APW19981118.0898",
                "APW19981119.0262",
                "APW19981124.0251",
                "NYT19981209.0451",
                "APW19981221.0189",
            ],
            "d30020t": [
                "APW19981002.0557",
                "APW19981029.0521",
                "APW19981030.1074",
                "APW19981102.0220",
                "APW19981126.0432",
                "APW19981126.0450",
                "APW19981128.0168",
                "APW19981206.0174",
                "APW19981206.0199",
                "APW19981206.0379",
            ],
            "d30022t": [
                "APW19981005.0231",
                "APW19981015.0177",
                "NYT19981202.0309",
                "APW19981202.1274",
                "APW19981203.0338",
                "NYT19981207.0280",
                "NYT19981209.0542",
                "NYT19981216.0357",
                "APW19981216.0666",
                "NYT19981217.0274",
            ],
            "d30024t": [
                "NYT19981007.0464",
                "NYT19981104.0369",
                "NYT19981104.0516",
                "NYT19981104.0545",
                "NYT19981104.0597",
                "NYT19981104.0600",
                "NYT19981105.0439",
                "NYT19981105.0509",
                "NYT19981105.0525",
                "NYT19981106.0464",
            ],
            "d30026t": [
                "NYT19981101.0082",
                "NYT19981122.0131",
                "NYT19981122.0163",
                "NYT19981123.0453",
                "NYT19981123.0458",
                "NYT19981123.0478",
                "NYT19981124.0340",
                "NYT19981124.0365",
                "NYT19981124.0411",
                "NYT19981125.0073",
            ],
            "d30027t": [
                "NYT19981001.0363",
                "NYT19981001.0379",
                "APW19981001.1177",
                "NYT19981002.0250",
                "NYT19981002.0300",
                "APW19981002.0778",
                "APW19981002.0783",
                "APW19981002.0809",
                "APW19981003.0292",
                "NYT19981004.0132",
            ],
            "d30028t": [
                "APW19981001.0539",
                "APW19981004.0182",
                "APW19981004.0296",
                "APW19981004.0321",
                "APW19981004.0550",
                "APW19981005.0236",
                "APW19981005.0457",
                "APW19981005.0467",
                "APW19981005.0474",
                "APW19981005.1033",
            ],
            "d30029t": [
                "APW19981224.0814",
                "APW19981226.0185",
                "APW19981227.0319",
                "APW19981227.0766",
                "APW19981227.0803",
                "APW19981227.0836",
                "APW19981227.0840",
                "APW19981227.0853",
                "APW19981227.0870",
                "APW19981228.0467",
            ],
            "d30031t": [
                "NYT19981203.0460",
                "NYT19981204.0365",
                "NYT19981206.0178",
                "APW19981207.0418",
                "APW19981207.0577",
                "APW19981207.0578",
                "APW19981207.0580",
                "APW19981207.0581",
                "APW19981207.0583",
                "NYT19981113.0404",
            ],
            "d30033t": [
                "NYT19981119.0380",
                "APW19981127.0244",
                "APW19981203.0649",
                "APW19981203.1240",
                "NYT19981223.0347",
                "APW19981228.0189",
                "APW19981229.0467",
                "APW19981230.0431",
                "APW19981230.0473",
                "APW19981231.0143",
            ],
            "d30034t": [
                "APW19981124.0554",
                "APW19981126.0443",
                "APW19981130.0497",
                "APW19981205.0792",
                "APW19981205.0807",
                "APW19981211.0972",
                "APW19981211.0982",
                "APW19981211.0990",
                "APW19981212.0541",
                "APW19981221.0448",
            ],
            "d30036t": [
                "APW19981006.0833",
                "APW19981007.0823",
                "NYT19981008.0338",
                "APW19981008.0523",
                "APW19981008.1113",
                "APW19981009.0788",
                "APW19981011.0541",
                "APW19981012.0252",
                "APW19981012.0267",
                "NYT19981012.0334",
            ],
            "d30037t": [
                "APW19981004.0138",
                "NYT19981009.0337",
                "NYT19981009.0369",
                "NYT19981009.0486",
                "APW19981009.1040",
                "APW19981010.0164",
                "APW19981010.0173",
                "APW19981010.0374",
                "APW19981010.0383",
                "APW19981012.0254",
            ],
            "d30038t": [
                "APW19981211.0352",
                "APW19981211.1276",
                "APW19981211.1288",
                "APW19981212.0354",
                "APW19981212.0562",
                "NYT19981213.0205",
                "APW19981213.0396",
                "APW19981213.0412",
                "APW19981213.0424",
                "APW19981213.0720",
            ],
            "d30040t": [
                "APW19981119.1180",
                "APW19981119.1227",
                "APW19981123.1179",
                "APW19981124.0254",
                "APW19981124.0256",
                "APW19981205.0220",
                "APW19981229.0756",
                "APW19981229.0763",
                "APW19981230.0983",
                "APW19981230.0991",
            ],
            "d30042t": [
                "APW19981019.0307",
                "APW19981129.0668",
                "APW19981202.1230",
                "APW19981205.0172",
                "APW19981205.0213",
                "APW19981206.0364",
                "APW19981206.0371",
                "APW19981209.1444",
                "APW19981212.0848",
                "APW19981221.1004",
            ],
            "d30044t": [
                "APW19981114.0575",
                "APW19981115.0371",
                "APW19981115.0618",
                "APW19981115.0626",
                "APW19981116.0221",
                "APW19981116.0235",
                "NYT19981116.0479",
                "APW19981116.1120",
                "APW19981117.0528",
                "APW19981117.0530",
            ],
            "d30045t": [
                "NYT19981125.0417",
                "NYT19981125.0433",
                "NYT19981126.0192",
                "NYT19981127.0203",
                "NYT19981127.0240",
                "NYT19981127.0256",
                "NYT19981127.0264",
                "NYT19981127.0289",
                "NYT19981127.0293",
                "NYT19981129.0113",
            ],
            "d30046t": [
                "NYT19981217.0394",
                "NYT19981218.0380",
                "NYT19981219.0101",
                "NYT19981219.0102",
                "NYT19981219.0104",
                "NYT19981219.0106",
                "NYT19981219.0117",
                "NYT19981219.0145",
                "NYT19981219.0148",
                "NYT19981219.0170",
            ],
            "d30047t": [
                "NYT19981113.0404",
                "APW19981119.0252",
                "APW19981120.0290",
                "NYT19981120.0427",
                "APW19981120.0892",
                "APW19981121.0727",
                "APW19981207.0577",
                "APW19981207.0578",
                "APW19981207.0580",
                "APW19981209.1470",
            ],
            "d30048t": [
                "APW19981016.0655",
                "APW19981017.0692",
                "APW19981019.0550",
                "NYT19981020.0380",
                "NYT19981020.0382",
                "APW19981020.1106",
                "APW19981021.1160",
                "APW19981021.1170",
                "APW19981022.1123",
                "NYT19981024.0050",
            ],
            "d30049t": [
                "APW19981023.0254",
                "NYT19981028.0441",
                "NYT19981114.0099",
                "NYT19981118.0464",
                "NYT19981121.0041",
                "NYT19981121.0117",
                "APW19981121.0131",
                "APW19981121.0344",
                "NYT19981122.0111",
                "APW19981203.0321",
            ],
            "d30050t": [
                "NYT19981002.0309",
                "NYT19981002.0366",
                "NYT19981005.0479",
                "NYT19981006.0394",
                "NYT19981008.0387",
                "NYT19981008.0453",
                "NYT19981009.0434",
                "NYT19981010.0027",
                "NYT19981010.0149",
                "NYT19981010.0151",
            ],
            "d30051t": [
                "APW19981108.0803",
                "APW19981111.0631",
                "NYT19981114.0079",
                "APW19981116.0213",
                "APW19981116.0231",
                "APW19981116.0525",
                "APW19981121.0514",
                "APW19981129.0969",
                "APW19981130.0803",
                "NYT19981202.0391",
            ],
            "d30053t": [
                "NYT19981127.0267",
                "APW19981206.0557",
                "APW19981206.0559",
                "APW19981207.1390",
                "APW19981208.0312",
                "APW19981210.0305",
                "APW19981211.0628",
                "APW19981212.0161",
                "APW19981213.0224",
                "APW19981216.0275",
            ],
            "d30055t": [
                "NYT19981004.0064",
                "APW19981004.0320",
                "NYT19981005.0306",
                "APW19981005.0721",
                "APW19981006.0270",
                "NYT19981009.0371",
                "APW19981009.0494",
                "APW19981009.0501",
                "APW19981009.0525",
                "APW19981012.0281",
            ],
            "d30056t": [
                "APW19981016.0448",
                "APW19981208.0906",
                "APW19981209.0688",
                "APW19981209.1423",
                "APW19981209.1425",
                "APW19981210.0940",
                "APW19981211.1223",
                "APW19981212.0189",
                "APW19981212.0191",
                "APW19981212.0597",
            ],
            "d30059t": [
                "APW19981120.1199",
                "APW19981120.1224",
                "APW19981120.1237",
                "APW19981120.1239",
                "APW19981121.0482",
                "NYT19981122.0110",
                "NYT19981122.0194",
                "APW19981122.0610",
                "APW19981123.0274",
                "APW19981124.0233",
            ],
            "d31001t": [
                "APW19981008.0841",
                "APW19981026.0485",
                "APW19981026.0787",
                "APW19981028.0231",
                "NYT19981028.0331",
                "NYT19981029.0366",
                "NYT19981031.0150",
                "APW19981031.0742",
                "NYT19981107.0056",
                "APW19981109.0767",
            ],
            "d31008t": [
                "NYT19981009.0436",
                "NYT19981009.0470",
                "NYT19981011.0203",
                "NYT19981012.0357",
                "NYT19981012.0359",
                "NYT19981013.0277",
                "NYT19981013.0349",
                "NYT19981016.0233",
                "NYT19981016.0257",
                "NYT19981016.0342",
            ],
            "d31009t": [
                "APW19981111.0309",
                "APW19981111.1240",
                "APW19981119.0529",
                "NYT19981202.0315",
                "APW19981202.0880",
                "APW19981203.0322",
                "APW19981209.0696",
                "APW19981219.0504",
                "APW19981221.1044",
                "APW19981228.0740",
            ],
            "d31013t": [
                "NYT19981102.0465",
                "NYT19981104.0619",
                "NYT19981104.0623",
                "NYT19981105.0521",
                "NYT19981106.0565",
                "APW19981109.0728",
                "NYT19981110.0442",
                "NYT19981112.0195",
                "NYT19981114.0057",
                "NYT19981114.0129",
            ],
            "d31022t": [
                "APW19981030.0230",
                "APW19981030.0470",
                "APW19981030.0489",
                "APW19981030.0792",
                "APW19981030.1037",
                "APW19981030.1041",
                "APW19981030.1046",
                "APW19981030.1066",
                "APW19981031.0314",
                "APW19981031.0551",
            ],
            "d31026t": [
                "NYT19981010.0022",
                "NYT19981014.0038",
                "NYT19981016.0291",
                "NYT19981017.0014",
                "NYT19981017.0027",
                "NYT19981017.0047",
                "NYT19981017.0052",
                "NYT19981017.0093",
                "NYT19981017.0132",
                "NYT19981018.0014",
            ],
            "d31031t": [
                "NYT19981001.0442",
                "NYT19981001.0499",
                "NYT19981011.0194",
                "NYT19981013.0339",
                "NYT19981013.0341",
                "NYT19981013.0399",
                "NYT19981013.0427",
                "NYT19981016.0245",
                "NYT19981016.0293",
                "NYT19981016.0312",
            ],
            "d31032t": [
                "APW19981001.0299",
                "APW19981007.0563",
                "APW19981011.0535",
                "APW19981012.0522",
                "APW19981012.1126",
                "APW19981013.0282",
                "APW19981014.0819",
                "APW19981015.0170",
                "APW19981015.0569",
                "APW19981016.0209",
            ],
            "d31033t": [
                "NYT19981007.0302",
                "NYT19981009.0282",
                "NYT19981012.0400",
                "NYT19981018.0065",
                "NYT19981018.0079",
                "NYT19981018.0084",
                "NYT19981018.0089",
                "NYT19981018.0091",
                "NYT19981018.0093",
                "NYT19981024.0043",
            ],
            "d31038t": [
                "APW19981023.0569",
                "NYT19981025.0187",
                "NYT19981026.0361",
                "NYT19981104.0491",
                "APW19981104.0772",
                "APW19981105.0282",
                "NYT19981110.0432",
                "APW19981111.0288",
                "APW19981112.0551",
                "APW19981120.0887",
            ],
            "d31043t": [
                "APW19981006.0802",
                "APW19981007.0567",
                "APW19981013.0301",
                "APW19981015.0163",
                "APW19981015.0167",
                "APW19981128.0178",
                "APW19981129.0871",
                "APW19981129.0896",
                "APW19981130.1079",
                "APW19981130.1085",
            ],
            "d31050t": [
                "APW19981005.0231",
                "APW19981220.0356",
                "APW19981220.0578",
                "APW19981221.0236",
                "NYT19981221.0377",
                "APW19981221.0719",
                "APW19981221.0757",
                "NYT19981222.0021",
                "APW19981223.0717",
                "APW19981224.0149",
            ]
        }

        


    def docsets_iter(self, year, task):

        if year == 2004:
            if task == 2 or task == 1:
                for docset_id in self.duc04_task1and2_docset_ids:
                    ds = DUCDocset(
                        docset_id,
                        os.path.join(self.duc04_task1and2_docsets, docset_id),
                        self.duc04_task1and2_docset_id2doc_ids[docset_id],
                        year=2004, task=[1,2])
                    yield ds
        else:
            raise Exception("Bad argument: year is {}".format(year))

class DUCDocset(object):
    def __init__(self, docset_id, path, doc_ids, year=None, task=None):
        self.docset_id = docset_id
        self.path = path
        self.doc_ids = doc_ids
        self.year = year
        self.task = task
    

    def __len__(self):
        return len(self.doc_ids)

    def __str__(self):
        return "DUCDocset('{}', '{}', {} documents, '{}', '{}')".format(
            self.docset_id, self.path[:10] + "...", len(self), self.year, 
            self.task)

    def __iter__(self):
        for doc_id in doc_ids:
            yield DUCDocument(doc_id, os.path.join(self.path, doc_id))

class DUCDocument(object):
    def __init__(self, doc_id, path):
        self.doc_id = doc_id
        self.path = path
        self._text = None

    def _read(self):
        if os.path.exists(self.path):
            with open(self.path, "rb") as f:
                self._text = f.read()
        else:
            raise Exception("DUCDocument {} not found at path {}".format(
                self.doc_id, self.path))

    def __str__(self):
        if self._text is None:
            self._read()
        return self._text

    def __unicode__(self):
        if self._text is None:
            self._read()
        return self._text.decode("utf-8")

    def __bytes__(self):
        if self._text is None:
            self._read()
        return self._text

